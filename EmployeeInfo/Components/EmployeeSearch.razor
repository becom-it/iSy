@using  EmployeeInfo.Models
@inject EmployeeInfo.Services.IEmployeeService empService

<div class="emp-search">
    <CoolInputAutoComplete InputChanged="InpChanged" SearchResult="FoundEmployeesDisplay" DebounceTime="500"/>
</div>

@code {


    [Parameter]
    public EventCallback<LdapEmployee> EmployeeSelected { get; set; }

    public List<LdapEmployee> FoundEmployees { get; set; } = new List<LdapEmployee>();
    public List<string> FoundEmployeesDisplay { get; set; } = new List<string>();

    public LdapEmployee CurrentEmployee { get; set; } = null;

    public string Found { get; set; }

    async Task InpChanged(string text)
    {
        if (string.IsNullOrEmpty(text) || text.Length < 3) return;

        if (FoundEmployeesDisplay.Contains(text))
        {
            CurrentEmployee = FoundEmployees.Where(x => x.DisplayName == text).FirstOrDefault();
            await EmployeeSelected.InvokeAsync(CurrentEmployee);
            return;
        }

        FoundEmployeesDisplay.Clear();
        FoundEmployees.Clear();
        FoundEmployees = await empService.SearchEmployee(text);
        FoundEmployeesDisplay = FoundEmployees.Select(x => x.DisplayName).ToList();

    }

    protected override async Task OnInitializedAsync()
    {
        if(CurrentEmployee == null)
        {
            //Aktuellen Mitarbeiter ermitteln
            var uname = "MPRATTINGE";
            //Aktuellen User laden
            CurrentEmployee = await empService.LoadEmployee(uname);
            await EmployeeSelected.InvokeAsync(CurrentEmployee);
        }
    }
}